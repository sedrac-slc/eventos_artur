(()=>{
    const textMaterialSearch = document.querySelector("#material");
    const tableMaterialSearch = document.querySelector("#table_material");
    const buttonMaterialSearch = document.querySelector("#btn_material");
    const routeMaterialSearch = document.querySelector('#material_search');

    const createMaterialTable = (tbody) => {
        return `<table class="table">
            <thead>
                <td>#</td>
                <td>nome</td>
                <td>quantidade</td>
                <td>imagem</td>
            </thead>
            <tbody>${tbody}</tbody>
        </table>`;
    }

    const buildTable = (data) => {
        let tbody = ``;
        data.forEach((item, index) => { tbody = `<tr>
                <td>
                    <input id="labMaterial${index}" class="form-check" name="material_id" value="${item.id}" type="radio"/></td>
                <td>
                    <label for="labMaterial${index}">${item.nome}</label>
                </td>
                <td>
                    <label>${item.quantidade}</label>
                </td>
                <td>
                    <img src="${imageLink(item.image)}" alt="" class="img-tab-min"/>
                </td>
            </tr>`;});
        tableMaterialSearch.innerHTML = createMaterialTable(tbody);
    };

    const imageLink = (image) => {
        return `${window.location.protocol}//${window.location.host}/storage/${image}`;
    }

    const ajaxMaterialSearch = () => {
        fetch(`${routeMaterialSearch.value}?name=${textMaterialSearch.value}`)
        .then(resp => resp.json())
        .then(data => buildTable(data))
    }

    buttonMaterialSearch.addEventListener('click',(e)=>{
        ajaxMaterialSearch();
    });

})();
